name: Copilot CLI Automation

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  generate-python-file:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js 22.x
        uses: actions/setup-node@v4
        with:
          node-version: '22.x'

      - name: Upgrade npm to 11.x or above
        run: npm install -g npm@latest

      - name: Install GitHub Copilot CLI
        run: npm install -g @github/copilot

      - name: Authenticate Copilot CLI
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          COPILOT_TOKEN: ${{ secrets.COPILOT_PAT }}
        run: |
          echo "$COPILOT_TOKEN" | gh auth login --with-token

      - name: Create testreport directory and list contents
        run: |
          mkdir -p testreport
          ls -l

      - name: Use Copilot CLI to generate Python file
        run: |
          copilot -p "create a simple python file to print hello world and save to helloworld.py in the root folder"
